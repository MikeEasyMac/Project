<div class="container mt-5">
  <div class="row mb-4 align-items-center">
      <div class="col-md-8">
          <h1 class="fw-bold text-white mb-0">Study Resources</h1>
          <p class="text-white-50">Materials posted by your professors to help you succeed.</p>
      </div>
      
      <% if (user.role === 'tutor' || user.role === 'admin') { %>
      <div class="col-md-4 text-end">
          <a href="/resources/publish" class="btn btn-light fw-bold text-primary shadow-sm">
              <i class="fas fa-upload me-2"></i>Publish Resource
          </a>
      </div>
      <% } %>
  </div>

  <div class="card border-0 shadow-lg mb-5">
      <div class="card-body p-4">
          <form action="/resources" method="GET" class="row g-3">
              <div class="col-md-7">
                  <div class="input-group">
                      <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                      <input type="text" name="search" class="form-control border-start-0 ps-0" placeholder="Search by title or tag..." value="<%= search || '' %>">
                  </div>
              </div>
              <div class="col-md-3">
                  <select name="course_id" class="form-select">
                      <option value="">All Subjects</option>
                      <% courses.forEach(function(c) { %>
                          <option value="<%= c.id %>" <%= course_id == c.id ? 'selected' : '' %>><%= c.title %></option>
                      <% }); %>
                  </select>
              </div>
              <div class="col-md-2 d-grid">
                  <button type="submit" class="btn btn-primary fw-bold">Find</button>
              </div>
          </form>
      </div>
  </div>

  <div class="row g-4">
      <% if (resources && resources.length > 0) { %>
          <% resources.forEach(function(res) { %>
              <div class="col-md-6 col-lg-4">
                  <div class="card h-100 border-0 shadow-sm hover-shadow transition-all">
                      <div class="card-body p-4 d-flex flex-column">
                          
                          <div class="d-flex justify-content-between align-items-start mb-3">
                              <div>
                                  <% if (res.course_title) { %>
                                      <span class="badge bg-primary bg-opacity-10 text-primary mb-2"><%= res.course_title %></span>
                                  <% } else { %>
                                      <span class="badge bg-secondary bg-opacity-10 text-secondary mb-2">General</span>
                                  <% } %>
                                  
                                  <% if (res.type === 'link') { %>
                                      <span class="badge bg-info text-dark ms-1"><i class="fas fa-link me-1"></i>Link</span>
                                  <% } else { %>
                                      <span class="badge bg-success ms-1"><i class="fas fa-file-alt me-1"></i>Note</span>
                                  <% } %>
                              </div>
                          </div>

                          <h5 class="fw-bold text-dark mb-2"><%= res.title %></h5>
                          
                          <% if (res.type === 'text') { %>
                              <p class="text-muted small mb-3 flex-grow-1">
                                  <%= res.content.length > 100 ? res.content.substring(0, 100) + '...' : res.content %>
                              </p>
                          <% } else { %>
                              <p class="text-muted small mb-3 flex-grow-1">External resource link.</p>
                          <% } %>

                          <% if (res.tags) { %>
                              <div class="mb-4">
                                  <% try { JSON.parse(res.tags).forEach(function(tag) { %>
                                      <span class="badge bg-light text-muted border fw-normal me-1">#<%= tag %></span>
                                  <% }); } catch(e) {} %>
                              </div>
                          <% } %>

                          <div class="mt-auto">
                              <% if (res.type === 'link') { %>
                                  <a href="<%= res.content %>" target="_blank" class="btn btn-outline-primary w-100 fw-bold">
                                      Open Link <i class="fas fa-external-link-alt ms-2"></i>
                                  </a>
                              <% } else { %>
                                  <button type="button" class="btn btn-outline-success w-100 fw-bold" data-bs-toggle="modal" data-bs-target="#resourceModal<%= res.id %>">
                                      Read Note
                                  </button>
                              <% } %>
                          </div>

                          <div class="mt-3 pt-3 border-top d-flex align-items-center small text-muted">
                              <i class="fas fa-user-circle me-2"></i>
                              Posted by <%= res.publisher_name %>
                          </div>

                      </div>
                  </div>
              </div>
          <% }); %>
      <% } else { %>
          <div class="col-12 text-center py-5">
              <div class="text-white opacity-50 display-1 mb-3">ðŸ“‚</div>
              <h3 class="text-white">No resources found.</h3>
              <p class="text-white-50">Try adjusting your search filters.</p>
          </div>
      <% } %>
  </div>
</div>

<% if (resources && resources.length > 0) { %>
  <% resources.forEach(function(res) { %>
      <% if (res.type === 'text') { %>
          <div class="modal fade" id="resourceModal<%= res.id %>" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                  <div class="modal-content" style="color: #333;">
                      <div class="modal-header">
                          <h5 class="modal-title fw-bold text-dark"><%= res.title %></h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                          <div class="p-3 bg-light rounded text-dark fs-5" style="white-space: pre-wrap; line-height: 1.6;"><%= res.content %></div>
                      </div>
                      <div class="modal-footer">
                          <button type="button" class="btn btn-secondary fw-bold px-4" data-bs-dismiss="modal">Close</button>
                      </div>
                  </div>
              </div>
          </div>
      <% } %>
  <% }); %>
<% } %>