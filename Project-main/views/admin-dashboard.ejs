<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-5">
      <div>
          <h1 class="display-5 fw-bold text-white mb-0">Admin Command Center</h1>
          <p class="lead text-white-50">Manage users, approve tutors, and moderate content.</p>
      </div>
  </div>

  <div class="row g-4 mb-5">
      <div class="col-md-3"><div class="card border-0 shadow-lg p-3 text-center h-100"><div class="display-6 fw-bold text-primary mb-0"><%= stats.total_users %></div><small class="text-muted fw-bold">Total Users</small></div></div>
      <div class="col-md-3"><div class="card border-0 shadow-lg p-3 text-center h-100"><div class="display-6 fw-bold text-warning mb-0"><%= stats.pending_tutors %></div><small class="text-muted fw-bold">Pending Tutors</small></div></div>
      <div class="col-md-3"><div class="card border-0 shadow-lg p-3 text-center h-100"><div class="display-6 fw-bold text-success mb-0"><%= stats.active_sessions %></div><small class="text-muted fw-bold">Active Sessions</small></div></div>
      <div class="col-md-3"><div class="card border-0 shadow-lg p-3 text-center h-100"><div class="display-6 fw-bold text-danger mb-0"><%= stats.resources_count %></div><small class="text-muted fw-bold">Resources</small></div></div>
  </div>

  <div class="row g-4">
      <div class="col-lg-8">
          
          <div class="card border-0 shadow-lg mb-4">
              <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                  <h5 class="fw-bold text-dark mb-0"><i class="fas fa-user-check text-warning me-2"></i>Pending Approvals</h5>
              </div>
              <div class="card-body p-0">
                  <% if (unapprovedTutors.length > 0) { %>
                      <div class="list-group list-group-flush">
                          <% unapprovedTutors.forEach(tutor => { %>
                              <div class="list-group-item px-4 py-3">
                                  <div class="d-flex justify-content-between align-items-center">
                                      <div>
                                          <h6 class="fw-bold mb-1 text-dark"><%= tutor.name %></h6>
                                          <p class="small text-muted mb-1"><%= tutor.email %></p>
                                          
                                          <span class="badge bg-primary">
                                              <i class="fas fa-book me-1"></i> <%= tutor.course_name || 'No Course Selected' %>
                                          </span>
                                          <span class="badge bg-success">$<%= tutor.hourly_rate %>/hr</span>
                                      </div>
                                      <div class="d-flex gap-2">
                                          <form action="/admin/approve-tutor/<%= tutor.id %>" method="POST">
                                              <button class="btn btn-success btn-sm fw-bold">Approve</button>
                                          </form>
                                          <form action="/admin/reject-tutor/<%= tutor.user_id %>" method="POST" onsubmit="return confirm('Reject this user?');">
                                              <button class="btn btn-outline-danger btn-sm fw-bold">Reject</button>
                                          </form>
                                      </div>
                                  </div>
                              </div>
                          <% }) %>
                      </div>
                  <% } else { %>
                      <div class="p-4 text-center text-muted">No pending tutor applications.</div>
                  <% } %>
              </div>
          </div>

          <div class="card border-0 shadow-lg">
              <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                  <h5 class="fw-bold text-dark mb-0"><i class="fas fa-users-cog text-primary me-2"></i>All Users</h5>
              </div>
              <div class="card-body p-0">
                  <div class="table-responsive" style="max-height: 400px;">
                      <table class="table table-hover align-middle mb-0">
                          <thead class="table-light">
                              <tr>
                                  <th class="ps-4">Name</th>
                                  <th>Role</th>
                                  <th>Status</th>
                                  <th class="text-end pe-4">Action</th>
                              </tr>
                          </thead>
                          <tbody>
                              <% allUsers.forEach(u => { %>
                                  <tr>
                                      <td class="ps-4">
                                          <div class="fw-bold text-dark"><%= u.name %></div>
                                          <div class="small text-muted"><%= u.email %></div>
                                      </td>
                                      <td><span class="badge bg-secondary"><%= u.role %></span></td>
                                      <td>
                                          <% if (u.status === 'active') { %>
                                              <span class="text-success fw-bold small">Active</span>
                                          <% } else { %>
                                              <span class="text-danger fw-bold small">Suspended</span>
                                          <% } %>
                                      </td>
                                      <td class="text-end pe-4">
                                          <% if (u.role !== 'admin') { %>
                                              <% if (u.status === 'active') { %>
                                                  <form action="/admin/suspend-user/<%= u.id %>" method="POST" class="d-inline">
                                                      <button class="btn btn-outline-danger btn-sm py-0 px-2" title="Suspend User">
                                                          <i class="fas fa-ban"></i>
                                                      </button>
                                                  </form>
                                              <% } else { %>
                                                  <form action="/admin/activate-user/<%= u.id %>" method="POST" class="d-inline">
                                                      <button class="btn btn-outline-success btn-sm py-0 px-2" title="Activate User">
                                                          <i class="fas fa-check-circle"></i>
                                                      </button>
                                                  </form>
                                              <% } %>
                                          <% } %>
                                      </td>
                                  </tr>
                              <% }) %>
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>
      </div>

      <div class="col-lg-4">
          <div class="card border-0 shadow-lg mb-4">
              <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                  <h5 class="fw-bold text-dark mb-0">Moderation</h5>
              </div>
              <div class="card-body p-3">
                  <% recentThreads.forEach(t => { %>
                      <div class="d-flex justify-content-between align-items-center mb-2 border-bottom pb-2">
                          <div class="text-truncate me-2" style="max-width: 200px;">
                              <span class="text-dark fw-bold"><%= t.title %></span>
                          </div>
                          <form action="/admin/delete-thread/<%= t.id %>" method="POST" onsubmit="return confirm('Delete?');">
                              <button class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
                          </form>
                      </div>
                  <% }) %>
              </div>
          </div>
          
          <div class="card border-0 shadow-lg">
              <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                  <h5 class="fw-bold text-dark mb-0">Audit Log</h5>
              </div>
              <div class="card-body p-0">
                  <div class="list-group list-group-flush" style="max-height: 300px; overflow-y: auto;">
                      <% auditLogs.forEach(log => { %>
                          <div class="list-group-item px-4 py-2">
                              <span class="text-dark small fw-bold"><%= log.action %></span>
                              <br><small class="text-muted"><%= new Date(log.created_at).toLocaleTimeString() %></small>
                          </div>
                      <% }) %>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>