<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center mb-5">
      <div>
          <h1 class="fw-bold text-white mb-0">My Tutoring Requests</h1>
          <p class="text-white-50">Track the status of your upcoming sessions.</p>
      </div>
      <% if (user.role === 'student') { %>
          <a href="/tutors" class="btn btn-light fw-bold text-primary shadow-sm">
              <i class="fas fa-search me-2"></i>Find a Tutor
          </a>
      <% } %>
  </div>

  <div class="row g-4">
      <% if (tutoringRequests && tutoringRequests.length > 0) { %>
          <% tutoringRequests.forEach(function(req) { %>
              <div class="col-lg-6">
                  <div class="card h-100 border-0 shadow-lg">
                      <div class="card-body p-4 d-flex flex-column">
                          
                          <div class="d-flex justify-content-between align-items-start mb-3">
                              <div>
                                  <h4 class="fw-bold text-dark mb-1"><%= req.topic %></h4>
                                  
                                  <% if (req.created_at) { %>
                                      <small class="text-muted">
                                          Requested on <%= new Date(req.created_at).toLocaleDateString() %>
                                      </small>
                                  <% } %>
                              </div>
                              
                              <% if (req.status === 'pending') { %>
                                  <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">Pending</span>
                              <% } else if (req.status === 'accepted') { %>
                                  <span class="badge bg-success px-3 py-2 rounded-pill">Confirmed</span>
                              <% } else if (req.status === 'cancelled') { %>
                                  <span class="badge bg-danger px-3 py-2 rounded-pill">Cancelled</span>
                              <% } %>
                          </div>

                          <hr class="text-muted opacity-25">

                          <div class="mb-3">
                              <div class="d-flex align-items-center mb-2">
                                  <div class="icon-square bg-light text-primary rounded p-2 me-3">
                                      <i class="fas <%= user.role === 'student' ? 'fa-chalkboard-teacher' : 'fa-user-graduate' %>"></i>
                                  </div>
                                  <div>
                                      <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">
                                          <%= user.role === 'student' ? 'Tutor' : 'Student' %>
                                      </small>
                                      <div class="fw-bold text-dark">
                                          <%= user.role === 'student' ? req.tutor_name : req.student_name %>
                                      </div>
                                  </div>
                              </div>

                              <div class="d-flex align-items-center">
                                  <div class="icon-square bg-light text-primary rounded p-2 me-3">
                                      <i class="fas fa-clock"></i>
                                  </div>
                                  <div>
                                      <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Time Slot</small>
                                      <div class="fw-bold text-dark">
                                          <%= new Date(req.start_time).toLocaleDateString() %> 
                                          <span class="text-muted fw-normal mx-1">|</span>
                                          <%= new Date(req.start_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %> - 
                                          <%= new Date(req.end_time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
                                      </div>
                                  </div>
                              </div>
                          </div>

                          <% if (req.details) { %>
                              <div class="p-3 bg-light rounded text-secondary small mb-3">
                                  <strong>Note:</strong> "<%= req.details %>"
                              </div>
                          <% } %>

                          <div class="mt-auto pt-2">
                              <% if (req.status === 'pending' || req.status === 'accepted') { %>
                                  <form action="/tutoring-requests/<%= req.id %>/cancel" method="POST" onsubmit="return confirm('Are you sure you want to cancel this request?');">
                                      <button class="btn btn-outline-danger w-100 fw-bold btn-sm">
                                          Cancel Request
                                      </button>
                                  </form>
                              <% } else { %>
                                  <button class="btn btn-secondary w-100 fw-bold btn-sm" disabled>
                                      Closed
                                  </button>
                              <% } %>
                          </div>

                      </div>
                  </div>
              </div>
          <% }); %>
      <% } else { %>
          <div class="col-12 text-center py-5">
              <div class="text-white opacity-50 display-1 mb-3">ðŸ“…</div>
              <h3 class="text-white">No requests found.</h3>
              <p class="text-white-50">Head over to <a href="/tutors" class="text-white text-decoration-underline">Browse Tutors</a> to book a session.</p>
          </div>
      <% } %>
  </div>
</div>