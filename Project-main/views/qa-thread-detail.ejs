<div class="container mt-5">
  <div class="mb-4">
      <a href="/qa" class="text-white text-decoration-none fw-bold"><i class="fas fa-arrow-left me-2"></i>Back to Feed</a>
  </div>

  <div class="card border-0 shadow-lg mb-5">
      <div class="card-body p-5">
          <div class="d-flex justify-content-between mb-3">
              <% if (thread.course_title) { %>
                  <span class="badge bg-primary bg-opacity-10 text-primary fs-6"><%= thread.course_title %></span>
              <% } else { %>
                  <span class="badge bg-secondary bg-opacity-10 text-secondary fs-6">General</span>
              <% } %>
              
              <form action="/report/thread/<%= thread.id %>" method="POST" onsubmit="return confirm('Report this thread?');">
                  <button type="submit" class="btn btn-link text-muted p-0 text-decoration-none small">
                      <i class="fas fa-flag me-1"></i>Report
                  </button>
              </form>
          </div>

          <h2 class="fw-bold text-dark mb-4"><%= thread.title %></h2>
          
          <div class="p-4 bg-light rounded text-dark fs-5 mb-4" style="white-space: pre-wrap;"><%= thread.content || 'No details provided.' %></div>

          <div class="d-flex align-items-center">
              <div class="avatar-circle bg-primary text-white rounded-circle me-3 d-flex align-items-center justify-content-center fw-bold" style="width: 48px; height: 48px; font-size: 1.2rem;">
                  <%= thread.creator_name.charAt(0) %>
              </div>
              <div>
                  <div class="fw-bold text-dark"><%= thread.creator_name %></div>
                  <small class="text-muted">Posted on <%= new Date(thread.created_at).toLocaleString() %></small>
              </div>
          </div>
      </div>
  </div>

  <h4 class="text-white fw-bold mb-4">Discussion (<%= posts.length %>)</h4>

  <% if (posts.length > 0) { %>
      <% posts.forEach(function(post) { %>
          <div class="card border-0 shadow-sm mb-3">
              <div class="card-body p-4">
                  <div class="d-flex">
                      <div class="me-3">
                          <div class="avatar-circle bg-light text-dark rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width: 40px; height: 40px;">
                              <%= post.poster_name.charAt(0) %>
                          </div>
                      </div>
                      
                      <div class="flex-grow-1">
                          <div class="d-flex justify-content-between align-items-center mb-2">
                              <div>
                                  <strong class="text-dark"><%= post.poster_name %></strong>
                                  <% if (post.poster_role === 'tutor') { %>
                                      <span class="badge bg-success ms-2">Tutor</span>
                                  <% } %>
                                  <span class="text-muted mx-2">&bull;</span>
                                  <small class="text-muted"><%= new Date(post.created_at).toLocaleString() %></small>
                              </div>
                              
                              <form action="/report/post/<%= post.id %>" method="POST" onsubmit="return confirm('Report this post?');">
                                  <button type="submit" class="btn btn-link text-muted p-0 text-decoration-none small">
                                      <i class="fas fa-flag"></i>
                                  </button>
                              </form>
                          </div>
                          <p class="text-dark mb-0" style="white-space: pre-wrap;"><%= post.content %></p>
                      </div>
                  </div>
              </div>
          </div>
      <% }); %>
  <% } else { %>
      <p class="text-white-50 mb-4">No replies yet. Be the first to answer!</p>
  <% } %>

  <div class="card border-0 shadow-lg mt-5 mb-5">
      <div class="card-body p-4">
          <h5 class="fw-bold text-dark mb-3">Join the discussion</h5>
          <form action="/qa/threads/<%= thread.id %>/reply" method="POST">
              <div class="mb-3">
                  <textarea name="content" class="form-control" rows="4" placeholder="Type your answer or follow-up question here..." required></textarea>
              </div>
              <button type="submit" class="btn btn-primary fw-bold px-4">Post Reply</button>
          </form>
      </div>
  </div>
</div>